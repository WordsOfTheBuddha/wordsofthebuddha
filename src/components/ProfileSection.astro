---
const { user } = Astro.props;
---

<div class="space-y-8">
	<!-- Account Information Section -->
	<div class="bg-[var(--auth-card-bg)] p-6 rounded-lg shadow-sm">
		<h2 class="text-xl font-semibold mb-4">Account Information</h2>
		<form id="profile-form" class="space-y-4">
			<div>
				<label for="displayName" class="block text-sm font-medium">Name</label>
				<input
					type="text"
					id="displayName"
					name="displayName"
					value={user.displayName}
					class="mt-1 block w-full px-3 py-2 bg-[var(--auth-input-bg)] border border-[var(--auth-input-border)] rounded-md"
				/>
			</div>
			<div>
				<label for="email" class="block text-sm font-medium">Email</label>
				<input
					type="email"
					id="email"
					name="email"
					value={user.email}
					class="mt-1 block w-full px-3 py-2 bg-[var(--auth-input-bg)] border border-[var(--auth-input-border)] rounded-md"
				/>
			</div>
			<button
				type="submit"
				class="px-4 py-2 bg-[var(--auth-button-bg)] text-white rounded-md hover:bg-[var(--auth-button-hover)]"
			>
				Save Changes
			</button>
		</form>
	</div>

	<!-- Preferences Section -->
	<div class="bg-[var(--auth-card-bg)] p-6 rounded-lg shadow-sm">
		<h2 class="text-xl font-semibold mb-4">Preferences</h2>
		<div class="flex items-center justify-between">
			<span class="text-sm font-medium">Theme</span>
			<div class="flex items-center space-x-2">
				<button
					class="px-3 py-1 text-sm rounded-md border border-[var(--auth-input-border)] theme-btn"
					data-theme="light"
				>
					Light
				</button>
				<button
					class="px-3 py-1 text-sm rounded-md border border-[var(--auth-input-border)] theme-btn"
					data-theme="dark"
				>
					Dark
				</button>
			</div>
		</div>
	</div>
</div>

<script>
	const profileForm = document.getElementById("profile-form");

	profileForm?.addEventListener("submit", async (e) => {
		e.preventDefault();
		const formData = new FormData(e.target as HTMLFormElement);

		try {
			const response = await fetch("/api/auth/update", {
				method: "POST",
				body: formData,
			});

			if (!response.ok) throw new Error("Update failed");

			// Refresh the page to show updated info
			window.location.reload();
		} catch (error) {
			console.error("Error updating profile:", error);
			alert("Failed to update profile");
		}
	});
</script>
